platform:
  - x86
  - x64

configuration:
  - Release

install:
  - call "C:\Program Files (x86)\Microsoft Visual Studio 10.0\VC\bin\amd64\vcvars64.bat"
  - rem call "C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat" x86_amd64
  - cd test
  - curl -L https://github.com/zxing/zxing/archive/00f634024ceeee591f54e6984ea7dd666fab22ae.zip -o zxing.zip
  - unzip -q zxing.zip -d zxing
  - mkdir zxing\zxing-00f634024ceeee591f54e6984ea7dd666fab22ae\cpp\build
  - cd zxing\zxing-00f634024ceeee591f54e6984ea7dd666fab22ae\cpp\build
  - rem if "%PLATFORM%"=="Win32" set CMAKE_GENERATOR_NAME=Visual Studio 14 2015
  - rem if "%PLATFORM%"=="x64"   set CMAKE_GENERATOR_NAME=Visual Studio 14 2015 Win64
  - rem cmake -G "%CMAKE_GENERATOR_NAME%" -DCMAKE_BUILD_TYPE=%CONFIGURATION% ..
  - cmake -G "NMake Makefiles" -DCMAKE_BUILD_TYPE=$(configuration) ..
  - nmake


build_script:
  - compile_cl.bat
  - cd test
  - compile_cl.bat

after_build:
  - 7z a qrencode.zip %APPVEYOR_BUILD_FOLDER%\build\qrencode.exe

test_script:
  - build\testencode.exe
  - python.exe run.py

artifacts:
  - path: qrencode.zip
    name: qrencode
    type: zip